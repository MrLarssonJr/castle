module Database extends "@easy-k8s/App.pkl"
import "DatabaseSecret.pkl"

password_secret_id: String

name = "database"
ports {
  ["postgres"] = 5432
}
image = "postgres:16.2"
env {
  new {
    name = "POSTGRES_PASSWORD"
    valueFrom {
      secretKeyRef = let (secret = module.components[password_secret_id] as DatabaseSecret) new {
          name = secret.name
          key = secret.key
        }
    }
  }
}
volumes {
  ["data"] {
    size = 5.gib
    path = "/var/lib/postgresql/data"
  }
}
