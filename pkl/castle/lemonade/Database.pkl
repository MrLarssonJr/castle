module Database extends "@easy-k8s/Component.pkl"
import "@easy-k8s/App.pkl"
import "@easy-k8s/Secret.pkl"

name = "database"
password_secret_id: String

part = new App {
  name = module.name
  ports {
    ["postgres"] = 5432
  }
  image = "postgres:16.2"
  env {
    new {
      name = "POSTGRES_PASSWORD"
      valueFrom {
        secretKeyRef {
          name = (module.parts[password_secret_id] as Secret).name
          key = "password"
        }
      }
    }
  }
  volumes {
    ["data"] {
      size = 5.gib
      path = "/var/lib/postgresql/data"
    }
  }
}
